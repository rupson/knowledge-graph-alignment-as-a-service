FROM maven:alpine as CLONER

RUN apk add --no-cahce git

# TODO: Clone with ssh
RUN git clone https://github.com/ernestojimenezruiz/logmap-matcher.git /usr/src/app/logmap-matcher

FROM maven:alpine as TARGET

RUN apk add --update --no-cache openssh 

RUN adduser -h /home/rob -s /bin/sh -D rob
RUN echo -n 'rob:rob' | chpasswd

COPY id_rsa.pub id_rsa.pub
RUN mkdir /home/rob/.ssh
RUN touch /home/rob/.ssh/authorized_keys
RUN cat id_rsa.pub >> /home/rob/.ssh/authorized_keys

COPY entrypoint.sh /
ENTRYPOINT ["/entrypoint.sh"]

EXPOSE 22

WORKDIR /usr/src/app
RUN mkdir out

COPY --from=CLONER /usr/src/app/logmap-matcher /usr/src/app/logmap-matcher

# COPY data data

WORKDIR /usr/src/app/logmap-matcher
RUN mvn install:install-file -Dfile=./lib/google-api-translate-java-0.97.jar -DgroupId=com.googlecode -DartifactId=google-api-translate-java -Dversion=0.97 -Dpackaging=jar
RUN mvn package

# java -jar target/logmap-matcher-4.0.jar MATCHER file:/usr/src/app/data/human.owl file:/usr/src/app/data/mouse.owl /usr/src/app/out true
